<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>México se Entere: Noticias Locales</title>
    <!-- Configuración para PWA: Indica el manifiesto -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Carga de Tailwind CSS para la estética -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { font-family: 'Inter', sans-serif; }
        /* Para limitar las líneas del resumen en la lista */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Estilo para el espacio del anuncio */
        .ad-placeholder {
            min-height: 150px;
            background-color: #fef3c7; /* Amarillo muy suave */
            border: 2px dashed #fcd34d; /* Borde punteado amarillo */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #b45309;
            font-weight: bold;
            text-align: center;
            margin: 2rem 0;
            padding: 1rem;
            border-radius: 0.5rem;
            flex-direction: column;
            transition: all 0.3s ease-in-out;
        }
        .ad-placeholder:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background-color: #fffbeb;
            transform: scale(1.02);
        }
        .ad-placeholder a {
            color: #b45309;
            text-decoration: underline;
            font-size: 1.1rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-emerald-600 text-white p-4 shadow-xl">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">México se Entere</h1>
                <p class="text-sm opacity-90">Atizapán, Tlane, Naucalpan e Izcalli</p>
            </div>
            <!-- Botón de Instalación PWA (será visible si el Service Worker falla o si el navegador lo requiere) -->
            <button id="installAppButton" style="display:none;" class="bg-white text-emerald-600 py-1 px-3 rounded-full font-semibold shadow hover:bg-emerald-50 transition duration-200">
                Instalar App
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6">
        
        <!-- ============================================== -->
        <!-- 1. CONTENEDOR DE LA LISTA (PÁGINA PRINCIPAL)   -->
        <!-- ============================================== -->
        <div id="newsListContainer">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-6 border-b-2 pb-2 border-emerald-500">Últimas Noticias Locales</h2>
            
            <!-- Aquí se inyectan las tarjetas -->
            <div id="newsList" class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <p class="col-span-full text-center text-gray-500 py-10">Cargando contenido...</p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- 2. CONTENEDOR DE DETALLE (INICIA OCULTO)       -->
        <!-- ============================================== -->
        <div id="newsDetailContainer" style="display: none;">
            <!-- La noticia completa se carga aquí -->
        </div>

    </main>
    
    <!-- ============================================== -->
    <!-- CÓDIGO JAVASCRIPT Y LÓGICA DE DATOS (SIN FIREBASE) -->
    <!-- ============================================== -->
    <script>
        
        // ===================================================================
        // *** ENLACES PATROCINADOS DEL PROPIETARIO ***
        // Se usarán para llenar el espacio de publicidad de forma rotativa.
        // ===================================================================
        const SPONSORED_LINKS = [
            { title: "ManzaBoom - El Mejor Software para tu Negocio", url: "https://manzaboom.com" },
            { title: "Mudanzas en México - ¡Tu mudanza sin estrés!", url: "https://mudanzas-en-mexico.com" },
            { title: "Tacos de Canasta en México - Sabor y Tradición", url: "https://tacosdecanastaenmexico.com" },
            { title: "Lexfortis Legal - Asesoría Jurídica y Corporativa", url: "https://lexfortis.legal" }
        ];

        // ===================================================================
        // *** BASE DE DATOS LOCAL (6 NOTICIAS INTEGRADAS) ***
        // ===================================================================
        const LOCAL_NEWS_DATA = [
            {
                id: "noticia-noroña-001",
                titulo: "Gerardo Fernández Noroña está siendo intensamente criticado por sus recientes declaraciones sobre Grecia Quiroz",
                resumen: "CIUDAD DE MÉXICO - El senador de Morena, Gerardo Fernández Noroña, se encuentra en el ojo del huracán tras sus controvertidas declaraciones dirigidas a Grecia Quiroz, alcaldesa de Uruapan, Michoacán, y viuda del asesinado alcalde Carlos Manzo. Sus comentarios han provocado una ola de indignación y acusaciones de violencia política de género, generando un inusual vacío en su propia conferencia de prensa. Las Declaraciones de la Polémica La controversia estalló después de que Grecia Quiroz solicitara públicamente que se investigara a los morenistas Raúl Morón Orozco (senador) y Leonel Godoy Rangel (diputado federal) por el homicidio de su esposo, ocurrido a principios de noviembre. Quiroz argumentó que la detención de un presunto autor intelectual no era suficiente y cuestionó las líneas de investigación. En respuesta, Fernández Noroña calificó las peticiones de la alcaldesa como 'irresponsables' y 'políticas', asegurando que a Quiroz 'se le despertó la ambición' por buscar la gubernatura de Michoacán. Además, la tildó de 'fascista' y de 'ultraderecha' por sus señalamientos. Reacciones y Aislamiento Las palabras de Noroña desataron una condena generalizada. Claudia Sheinbaum, presidenta de México, intervino públicamente para pedir 'sensibilidad' con la alcaldesa, dadas las circunstancias de duelo que atraviesa. Senadoras de Morena y oposición se deslindaron de Noroña y lo acusaron directamente de incurrir en violencia política de género y revictimización. La militancia y usuarios de redes criticaron su falta de empatía, llevando incluso a que Noroña desactivara comentarios en sus publicaciones. En un hecho simbólico, cuando Noroña convocó a una conferencia de prensa en el Senado para defender su postura y negar las acusaciones de misoginia, fue ignorado por la mayoría de los medios acreditados, quienes dejaron la sala vacía, evidenciando el rechazo a sus dichos.",
                imagenUrl: "https://placehold.co/600x400/94a3b8/ffffff?text=NACIONAL+POL%C3%8DTICA",
                fecha: new Date('2025-11-26T18:07:16').getTime(), // 26 de noviembre de 2025, 12:07:16 p.m. UTC-6
                categoria: "México"
            },
            {
                id: "noticia-nicolasromero-002",
                titulo: "Denuncian vecinos de la Col. Francisco I. Madero represión policial tras cuestionar obras inconclusas en Nicolás Romero",
                resumen: "NICOLÁS ROMERO, Méx.— Residentes de la colonia Francisco I. Madero vivieron momentos de tensión y agresión 'en carne propia' este miércoles, cuando, según sus testimonios, fueron objeto de 'prepotencia, represión y violencia' por parte de elementos de la policía municipal. Los hechos ocurrieron luego de que un grupo de habitantes se acercara a las autoridades locales para hacer observaciones y cuestionar el notable retraso en la finalización de obras de pavimentación y rehabilitación de una calle en su comunidad. Los vecinos buscaban dialogar sobre la ejecución del proyecto, que presenta un avance cuestionable y ha generado molestias en la zona. De acuerdo con la denuncia pública, la respuesta de las fuerzas del orden no fue la de mediar o atender las inquietudes ciudadanas, sino que escaló rápidamente a una confrontación, resultando en agresiones directas hacia los colonos que exigían transparencia y la conclusión de los trabajos prometidos. Hasta el momento, las autoridades municipales de Nicolás Romero no han emitido una declaración oficial sobre los métodos empleados por los agentes ni sobre el estado actual de las obras en la mencionada colonia. Los afectados exigen una investigación y que se tomen medidas contra los responsables de la agresión.",
                imagenUrl: "https://placehold.co/600x400/0f766e/ffffff?text=NICOL%C3%81S+ROMERO",
                fecha: new Date('2025-11-26T22:20:31').getTime(), // 26 de noviembre de 2025, 4:20:31 p.m. UTC-6
                categoria: "nicolas romero"
            },
            {
                id: "noticia-tlalnepantla-003",
                titulo: "ÚLTIMA HORA: Concluye reparación de mega fuga en Atizapán; servicio de agua se restablecerá gradualmente en Tlalnepantla ",
                resumen: "Tlalnepantla de Baz, Méx. a 26 de noviembre de 2025 - La Comisión del Agua del Estado de México (CAEM) ha finalizado los trabajos de reparación de la mega fuga en una línea de 60 pulgadas del Sistema Barrientos, ubicada en San Miguel Xochimanga, Atizapán de Zaragoza, que dejó sin agua a más de 150 colonias de Tlalnepantla durante varios días. Tras más de 96 horas de labores ininterrumpidas, la infraestructura ha sido reparada. Las autoridades informaron que el suministro de agua comenzará a restablecerse de manera gradual en las zonas afectadas de Tlalnepantla. Detalles de la afectación y recuperación: Causa: Una importante avería en la línea principal de la CAEM interrumpió el abasto hacia la Planta Barrientos, que surte a los tanques Tlayapa, Tenayo y Tlalnemex en Tlalnepantla. Colonias afectadas: Se vieron afectadas colonias de la zona poniente y otras áreas bajas del municipio, incluyendo Lázaro Cárdenas, Zona Industrial La Presa, Tlalnemex, U.H. Tenayo y El Olivo Parte Baja. Restablecimiento: El Organismo Público Descentralizado para la Prestación de los Servicios de Agua Potable, Alcantarillado y Saneamiento (OPDM) de Tlalnepantla ha iniciado el proceso de normalización del servicio. Sin embargo, debido a la magnitud de la falla y la extensión de la red, el restablecimiento completo puede tomar tiempo. Apoyo con pipas continúa: Mientras el servicio se normaliza por completo, el OPDM Tlalnepantla mantiene activo el operativo de distribución de agua potable gratuita mediante pipas para las familias que aún no cuentan con el servicio. Los ciudadanos afectados pueden solicitar una pipa o reportar la falta de suministro a los números del OPDM: Call Center: 55 5321 0840 WhatsApp: 55 3008 1603 Las autoridades recomiendan a los residentes hacer un uso eficiente del agua y mantenerse informados a través de los canales oficiales del OPDM Tlalnepantla y del Gobierno de Tlalnepantla.",
                imagenUrl: "https://placehold.co/600x400/1e40af/ffffff?text=TLALNEPANTLA+AGUA",
                fecha: new Date('2025-11-27T00:39:17').getTime(), // 26 de noviembre de 2025, 6:39:17 p.m. UTC-6
                categoria: "tlalnepantla"
            },
            {
                id: "noticia-izcalli-004",
                titulo: "Buscan a Jeshua, desaparecido en Cuautitlán Izcalli...",
                resumen: "La noche del pasado 13 de noviembre, Jeshua salió de la casa de un amigo en la colonia Jardines de la Hacienda, por la hora ya no alcanzó transporte y tuvo que caminar, se dirigía hacia su casa en la colonia Arcos del Alba en el municipio de Cuautitlán Izcalli, pero desapareció mientras caminaba a un lado de la autopista México-Querétaro, así indicó su mamá Karla Rendón. Han pasado 14 días y no hay indicios que lleven al paradero de Jeshua e incluso, su familia se ha enfrentado a varias complicaciones, en una primera instancia en el área de búsqueda de personas desaparecidas, la cual no trabaja durante los fines de semana y menos durante fines de semana largos, por ello, pese a que levantó la denuncia el viernes, entre vuelta y vuelta de una sede a otra, salió de la Fiscalía General de Justicia del Estado de México (FGJEM) hasta las 5:00 de la mañana del sábado 15 de noviembre con la ficha de búsqueda.",
                imagenUrl: "https://placehold.co/600x400/991b1f/ffffff?text=IZCALLI+BUSQUEDA",
                fecha: new Date('2025-11-26T21:00:41').getTime(), // 26 de noviembre de 2025, 3:00:41 p.m. UTC-6
                categoria: "Cuatitlan Izcallí"
            },
            {
                id: "noticia-atizapan-005",
                titulo: "¡INDIGNANTE! ¡CORRUPCIÓN Y CINISMO GUBERNAMENTAL EN ATIZAPÁN!",
                resumen: "¡VECINOS CLAMAN JUSTICIA MIENTRAS EL GOBIERNO SE BURLA DE SU TRAGEDIA! Un hedor a podredumbre política se mezcla con las aguas negras que aún inundan los hogares de San Miguel Xochimanga. La 'megafuga' del pasado 22 de noviembre, cortesía de la negligencia de la CAEM, ha dejado a decenas de familias en la miseria absoluta, pero la peor inundación es la de la indolencia oficial. ¡CHANTAJE OFICIAL: O PAGAS EL PREDIAL O TE HUNDES EN LA MISERIA! Testimonios desgarradores revelan el modus operandi del gobierno municipal. Brigadistas y funcionarios, con una frialdad escalofriante, condicionan la ayuda a los damnificados: 'Si no estás al corriente con tu predial, ¡olvídate del apoyo!' ¿Es este el precio por recuperar el refrigerador, la cama o la estufa que la ineptitud gubernamental les arrebató? ¡Es un chantaje descarado en medio de la desgracia! PÉRDIDAS TOTALES Y UNA AYUDA DE CARIDAD Las imágenes son dantescas: hogares convertidos en ciénagas, muebles flotando y la desesperación pintada en los rostros de quienes lo perdieron todo. 'Perdimos todo, se nos ahogaron hasta los animales', gritan los afectados, que con cubetas y a mano limpia intentan rescatar lo poco que queda, mientras la ayuda real brilla por su ausencia. La tragedia, que pudo haberse evitado, ahora es el escenario perfecto para la rapiña burocrática. La ciudadanía exige indemnizaciones justas, pero recibe a cambio promesas vacías y condiciones leoninas. ¿Hasta cuándo permitirá el pueblo de Atizapán este atropello? ¡La indignación crece y la olla de presión social está a punto de estallar!",
                imagenUrl: "https://placehold.co/600x400/f97316/ffffff?text=ATIZAP%C3%81N+INUNDACI%C3%93N",
                fecha: new Date('2025-11-26T23:13:28').getTime(), // 26 de noviembre de 2025, 5:13:28 p.m. UTC-6
                categoria: "atizapan"
            },
            {
                id: "noticia-naucalpan-006",
                titulo: "¡Pánico TOTAL en Naucalpan! Misterioso 'Enjambre Sísmico' Desata el Terror y Siembra Dudas sobre Fallas Ocultas",
                resumen: "NAUCALPAN, Méx.— ¡La tierra se abre bajo nuestros pies! El pasado jueves, una serie de 'jalones' mortales sacudieron a los habitantes de Naucalpan, desatando el caos y el pánico generalizado. Lo que las autoridades minimizan como 'microsismos' de magnitudes insignificantes, fue en realidad una oleada de terror que puso a prueba los nervios de miles de familias. Testigos aterrorizados narran cómo los muebles se movieron violentamente y se escucharon estruendos apocalípticos, como si el fin del mundo estuviera cerca. 'Se sintió como si fuera una explosión, fue demasiado fuerte', declaró un residente de Lomas de Sotelo, visiblemente afectado. Microsismos en Naucalpan Generan Inquietud, Autoridades Monitorean la Situación NAUCALPAN, Méx.— Residentes de Naucalpan experimentaron microsismos el pasado jueves, generando preocupación entre la población. Aunque el Servicio Sismológico Nacional reportó magnitudes menores, los eventos causaron alarma en diversas zonas del municipio. Los microsismos, que no superaron los 2.5 grados de magnitud según el Servicio Sismológico Nacional, fueron perceptibles para los habitantes, quienes reportaron movimientos y ruidos asociados. Un residente de Lomas de Sotelo describió la sensación como 'fuerte'.",
                imagenUrl: "https://placehold.co/600x400/ca8a04/ffffff?text=NAUCALPAN+SISMOS",
                fecha: new Date('2025-11-27T00:20:15').getTime(), // 26 de noviembre de 2025, 6:20:15 p.m. UTC-6
                categoria: "Naucalpan"
            }
        ];
        
        // Referencias a elementos del DOM
        const newsListContainer = document.getElementById('newsListContainer');
        const newsDetailContainer = document.getElementById('newsDetailContainer');
        const newsListDiv = document.getElementById('newsList');
        const installAppButton = document.getElementById('installAppButton');
        let deferredPrompt; // Variable para guardar el evento de instalación de PWA
        
        
        // ------------------------------------------------------------------
        // E. FUNCIÓN PARA OBTENER EL ANUNCIO ROTATIVO
        // ------------------------------------------------------------------
        function getRandomSponsoredLink() {
            const index = Math.floor(Math.random() * SPONSORED_LINKS.length);
            const ad = SPONSORED_LINKS[index];
            return `
                <p class="text-xl font-extrabold text-gray-900 mb-2">✨ ANUNCIO PATROCINADO ✨</p>
                <a href="${ad.url}" target="_blank" rel="noopener noreferrer" class="font-bold hover:text-orange-700 transition">
                    ${ad.title}
                </a>
                <p class="text-sm text-gray-600 mt-1">Visítanos en ${ad.url.replace(/(^\w+:|^)\/\//, '').replace('www.', '')}</p>
            `;
        }

        // ------------------------------------------------------------------
        // A. FUNCIÓN PARA VOLVER A LA LISTA PRINCIPAL
        // ------------------------------------------------------------------
        function showNewsList() {
            newsListContainer.style.display = 'block'; 
            newsDetailContainer.style.display = 'none'; 
            newsDetailContainer.innerHTML = ''; 
        }
        window.showNewsList = showNewsList; // Hacer la función accesible globalmente

        // ------------------------------------------------------------------
        // B. FUNCIÓN PARA IR AL DETALLE Y CARGAR EL CONTENIDO COMPLETO
        // ------------------------------------------------------------------
        function showNewsDetailPage(newsId) {
            
            showNewsList(); // Oculta la lista por si acaso
            newsListContainer.style.display = 'none';
            newsDetailContainer.style.display = 'block';
            
            // Buscar la noticia por ID en la base de datos local
            const data = LOCAL_NEWS_DATA.find(news => news.id === newsId);
            
            // Función para obtener la etiqueta de municipio
            const getMunicipioTag = (category) => {
                const map = {
                    'atizapan': 'Atizapán',
                    'tlalnepantla': 'Tlalnepantla',
                    'naucalpan': 'Naucalpan',
                    'cuatitlan izcallí': 'Izcalli',
                    'nicolas romero': 'Nicolás Romero',
                    'méxico': 'Nacional' 
                };
                return map[category.toLowerCase()] || 'Edomex';
            };
            const municipioTag = getMunicipioTag(data.categoria);

            // Obtener el anuncio rotativo
            const adContent = getRandomSponsoredLink
